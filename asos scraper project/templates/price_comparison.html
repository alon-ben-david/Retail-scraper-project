<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Price Comparison</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <input type="text" id="product_details" placeholder="Enter product details">
    <button onclick="searchAndDisplayProduct()">Search</button>

    <div id="successMessage" style="color: green;"></div>

    <table id="resultTable">
        <thead>
            <tr>
                <th>Product Name</th>
                <th>Country</th>
                <th>Cheapest Price</th>
            </tr>
        </thead>
        <tbody>
            <!-- Table body will be updated dynamically -->
        </tbody>
    </table>

    <script>
        function searchAndDisplayProduct() {
    var productDetails = document.getElementById('product_details').value;

    // Encode the data for the form-urlencoded format
    var formData = new URLSearchParams();
    formData.append('product_details', productDetails);

    // Make an AJAX/Fetch request to the backend
    fetch('/price_comparison', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: formData.toString(), // Convert the form data to a string
    })
    .then(response => response.json())
    .then(data => {
        console.log("Received data:", data);
        if (data.success) {
            displaySuccessMessage("Data successfully received!");
            updateTable(data.data); // Call the function to update the table
        } else {
            displayErrorMessage("Error in data retrieval: " + data.error);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        displayErrorMessage("Error in data retrieval. Please try again.");
    });
}

// JavaScript code
function updateTable(data) {
    var resultTable = document.getElementById('resultTable').getElementsByTagName('tbody')[0];

    // Clear existing table content
    resultTable.innerHTML = '';

    if ( !data) {
        // Handle case when there's no data or an error occurred
        console.log("No data available or error occurred");
        return;
    }

    // Assuming datais a JSON-formatted string
    var parsedData = JSON.parse(data);

    // Assuming parsedData is an array of objects with keys 'product_name', 'Country', and 'Cheapest_Price'
    parsedData.forEach(item => {
        var row = resultTable.insertRow();
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        var cell3 = row.insertCell(2);

        cell1.innerHTML = item.product_name;
        cell2.innerHTML = item.Country;
        cell3.innerHTML = item.Cheapest_Price;
    });
}


        function displaySuccessMessage(message) {
            var successMessageElement = document.getElementById('successMessage');
            successMessageElement.textContent = message;
        }

        function displayErrorMessage(message) {
            var successMessageElement = document.getElementById('successMessage');
            successMessageElement.style.color = 'red';
            successMessageElement.textContent = message;
        }
    </script>
</body>
</html>
